name: Example Self-Hosted Runner Workflow

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:  # ÐŸÐ¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ‚ÑŒ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ

jobs:
  # ÐŸÑ€Ð¾ÑÑ‚Ð¾Ð¹ job Ð½Ð° self-hosted runner
  hello-world:
    runs-on: self-hosted

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Hello from self-hosted runner
        run: |
          echo "ðŸš€ Running on self-hosted runner!"
          echo "Hostname: $(hostname)"
          echo "User: $(whoami)"
          echo "OS: $(uname -a)"

  # Job Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼ Docker
  docker-build:
    runs-on: [self-hosted, docker]

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check Docker
        run: |
          echo "Docker version:"
          docker --version
          docker compose version

      - name: Build example image
        run: |
          cat > Dockerfile.example << 'EOF'
          FROM alpine:latest
          RUN echo "Hello from Docker build!"
          CMD ["echo", "Container started successfully"]
          EOF

          docker build -f Dockerfile.example -t test-image .

      - name: Run container
        run: |
          docker run --rm test-image

      - name: Cleanup
        if: always()
        run: |
          docker rmi test-image || true
          rm -f Dockerfile.example

  # Job Ñ Node.js
  node-test:
    runs-on: self-hosted

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Create test package
        run: |
          cat > package.json << 'EOF'
          {
            "name": "test",
            "version": "1.0.0",
            "scripts": {
              "test": "echo \"Tests passed!\" && exit 0"
            }
          }
          EOF

      - name: Install dependencies
        run: npm install

      - name: Run tests
        run: npm test

  # Job Ñ Python
  python-test:
    runs-on: self-hosted

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Create test script
        run: |
          cat > test.py << 'EOF'
          import sys
          print(f"Python {sys.version}")
          print("âœ… Python test passed!")
          EOF

      - name: Run Python script
        run: python test.py

  # ÐŸÐ°Ñ€Ð°Ð»Ð»ÐµÐ»ÑŒÐ½Ñ‹Ðµ jobs
  parallel-jobs:
    runs-on: self-hosted
    strategy:
      matrix:
        task: [task1, task2, task3]

    steps:
      - name: Run parallel task
        run: |
          echo "Running ${{ matrix.task }}"
          sleep 5
          echo "${{ matrix.task }} completed!"

  # Job Ñ ÑƒÑÐ»Ð¾Ð²Ð½Ñ‹Ð¼ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸ÐµÐ¼
  conditional-job:
    runs-on: self-hosted
    if: github.event_name == 'push'

    steps:
      - name: Only on push
        run: echo "This runs only on push events"

  # Ð¤Ð¸Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ job (Ð·Ð°Ð²Ð¸ÑÐ¸Ñ‚ Ð¾Ñ‚ Ð²ÑÐµÑ… Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ñ…)
  summary:
    runs-on: self-hosted
    needs: [hello-world, docker-build, node-test, python-test, parallel-jobs]
    if: always()

    steps:
      - name: Workflow summary
        run: |
          echo "ðŸŽ‰ All jobs completed!"
          echo "Status: ${{ job.status }}"
